# Product Specification: Arc Keepers

## 1. Project Overview

**Arc Keepers** is a Progressive Web App (PWA) companion for the game _ARC Raiders_. It helps players track "Loot Items" needed for various game goals (crafting, quests, upgrades).

- **Goal:** A "to-do list" for loot. Users see what they need, track what they have picked up, and hide items once requirements are met.
- **Platform:** Web / PWA (GitHub Pages).
- **Privacy:** No backend. All data persists in browser `localStorage`.
- **UX Priority:** Fast keyboard navigation, dark mode, high-density information.

## 2. Technical Stack

- **Framework:** React (Vite) + TypeScript.
- **Styling:** Tailwind CSS.
- _Theme:_ Dark, slate/zinc palette, high contrast text.

- **State Management:** **Zustand**.
- Middleware: `persist` (for LocalStorage).

- **Data Parsing:** `papaparse` (for CSV ingestion).
- **Icons:** `lucide-react`.

## 3. Data Architecture

### 3.1. Concepts

1. **Required Items:** A read-only reference list of all items in the game.
2. **Keeplists:** "Buckets" of requirements.

- _Inventory Logic:_ Inventory is **Allocated**, not Global. If "Workbenches" needs 5 Resin and "Quests" needs 5 Resin, they are tracked separately. Adding to one does not affect the other.

### 3.2. Data Models (TypeScript)

```typescript
// Read-only reference from CSV/API
interface RequiredItem {
  id: string; // e.g., "rusted-gear"
  name: string; // e.g. "Rusted Gear"
  rarity: "Common" | "Uncommon" | "Rare" | "Epic" | "Legendary";
}

// User State (Persisted)
interface AppState {
  keeplists: Keeplist[];
  settings: AppSettings;
}

interface AppSettings {
  showCompleted: boolean;
  activeKeeplistIds: string[]; // IDs of active keeplists (empty = all active)
}

interface Keeplist {
  id: string; // Autogenerated slug from the name
  name: string; // e.g., "Workbenches", "Expedition 2"
  isSystem: boolean; // true = provided by app, false = user made
  items: KeeplistItem[];
}

interface KeeplistItem {
  itemId: string; // Relates to RequiredItem.id
  qtyOwned: number; // User input
  qtyRequired: number; // Target (from system or user).
  // NOTE: If 0, implies "infinite demand" (never completes)
  isCompleted: boolean; // Derived state (owned >= required, false if qtyRequired=0)
}
```

### 3.3. Data Sources

**Item Data:** Fetched from the MetaForge API using the Item Crawler dev tool (`npm run fetch-items`). Stored in `src/data/allItems.ts`.

**System Keeplists:** Maintained using the Keeplist Builder dev tool and stored in `src/data/systemKeeplists.ts`. The app ships with predefined keeplists (e.g., "Workbenches", "Expedition 2", "Flickering Flames").

**User Keeplists:** Created by users through the "My Keeplists" UI. Stored in browser localStorage alongside other app state.

### 3.4. User Keeplists

Users can create custom keeplists to track items they need:

- **Create:** Name a new keeplist (auto-generates slug ID)
- **Add Items:** Search and add items from the game database
- **Set Quantities:** Specify how many of each item is needed
  - Set to **0** for "infinite demand" (item is always tracked, never completes)
- **Remove Items:** Delete items from the keeplist
- **Delete Keeplist:** Remove an entire custom keeplist

User keeplists are distinguished from system keeplists (`isSystem: false`) and cannot be edited by app updates.

### 3.5. Active Keeplists

Users can toggle which keeplists appear in the main view:

- **All Active:** By default, all keeplists (system and user) are active
- **Selective:** Users can disable specific keeplists to hide their items
- **New System Keeplists:** When the app adds new system keeplists, they are automatically enabled for existing users
- **Persistence:** Active/inactive state is saved to localStorage

## 4. Core Logic

### 4.1. System Data Merging (Versioning)

When the app loads, it checks against a "System Data" file.

- **Scenario:** The app maintainer updates the required count for an item in a System Keeplist.
- **Logic:**

1. If the user's local item was **Incomplete**: Update `qtyRequired` to the new value. Preserve user's `qtyOwned`.
2. If the user's local item was **Complete** (`qtyOwned` >= old `qtyRequired`): Update `qtyRequired` AND set `qtyOwned` to the new `qtyRequired`.

- _Reasoning:_ Assume the user already turned in the quest/item, so they don't need to hunt for the difference.

### 4.2. Visual Feedback & Completion

- **Progress:** Visual bar indicating `qtyOwned / qtyRequired`.
- **Quick Tick:** A "Check" button on every row that instantly sets `qtyOwned` to `qtyRequired`.
- **Dimming:** When a specific row (Item X in List Y) is complete, that row dims.
- **Fading:** If **ALL** active rows for a Required Item are complete, the entire Required Item card fades out after **5 seconds** (CSS transition) and is removed from the view (unless "Show Completed" is enabled).

### 4.3. Data Migration

- **Export:** Button to download current state (`localStorage` dump) as JSON.
- **Import:** Button to upload JSON and overwrite `localStorage`.

## 5. User Interface (UI)

### 5.1. Layout

- **Header:** Logo, Keeplists button, "Show Completed" toggle, Settings (Import/Export).
- **Intro:** A small, collapsible section explaining how the app works (Keeplists, Allocations).
- **Search Bar:** Sticky top. Performs "Subtext Matching" (fuzzy search). Escape key clears search.
- **Main View:** Vertical list of **Required Item Cards** (from active keeplists only).

### 5.1.1 Keeplists Panel

Accessed via the "Keeplists" button in the header. Contains two tabs:

- **Active Lists:** Toggle which keeplists appear in the main view
  - System keeplists shown with blue checkboxes
  - User keeplists shown with green checkboxes
  - Shows item count for each keeplist
- **My Keeplists:** Create and manage custom keeplists
  - Create new keeplists by name
  - Add/remove items with search autocomplete
  - Set required quantities (0 for unlimited)
  - Delete entire keeplists

### 5.2. Item Card Design

The list is organized by **Item**, not by List. Sorted alphabetically by name.

- **Card Layout (Horizontal):**
  - **Left:** Item icon with rarity-colored left border, quantity badge (×N total needed)
  - **Middle:** Item name, rarity text, list count ("Rare · 2 lists")
  - **Right:** Stacked keeplist demand rows

- **Demand Row:** `[Keeplist Name] [Progress Bar] [Owned/Required] [-] [+] [✓]`

- **Rarity Colors:**
  - Common: Gray
  - Uncommon: Green
  - Rare: Blue
  - Epic: Purple
  - Legendary: Amber

- **Behavior:** Only show Item Cards that have at least one active (incomplete) requirement from an active keeplist, unless "Show Completed" is on.

### 5.3. Keyboard Navigation (Critical)

- **Alpha-Hijack:**
  - If the user types `a-z` while not in an input field:
    1. Focus the Search Bar.
    2. Input the pressed key (append to existing text).
  - **Disabled when:** Ctrl, Alt, or Meta (Cmd) is held (allows Cmd+R, Cmd+C, etc.)
  - Note: This does not apply to `0-9` or other characters.

- **Search Bar:**
  - `Escape` clears the search query

- **Tab Traversal (Custom Order):**
  - From search box, Tab cycles through:
    1. All increment (+) buttons
    2. All completion (✓) buttons
    3. All decrement (-) buttons
    4. Clear search button
    5. Back to search box
  - This allows efficient keyboard-only quantity entry.

### 5.4. Image Handling

- **Primary Source:** MetaForge CDN for item icons
- **Fallback:** Placeholder image with item initials

```javascript
const getItemImage = (slug: string) =>
  `https://cdn.metaforge.app/arc-raiders/icons/${slug}.webp`;
```

## 6. Developer Tools (Internal)

_These tools should be accessible via a hidden route (e.g., `/dev`) to allow maintainers to generate the CSV files and test assets._

### 6.1. Item Crawler (API to CSV)

A tool to fetch Required Item data.

- **Source:** `https://metaforge.app/arc-raiders/api`
- **Task:** The AI must read the API documentation/response structure from this URL.
- **Output:** A button that fetches the data and converts it into a CSV format matching the `RequiredItem` interface (Id, Name, Category, Rarity, ImageSlug).

### 6.2. Keeplist Builder

A UI tool to create the "System Keeplists".

- **Function:** Allow the developer to select items from the Master List, set `qtyRequired`, and assign them to a list name (e.g., "Workbenches").
- **Output:** Export the result as a CSV file (`system_keeplists.csv`).

### 6.3. Image Integrity Tester

A tool to ensure image URLs are valid.

- **Function:** Iterate through the entire `RequiredItem` list.
- **Logic:** Run the `getItemImage(slug)` function for every item and attempt to fetch the image.
- **Report:** Display a list of any items that return a 404 or error, ensuring the production app doesn't have broken images.
