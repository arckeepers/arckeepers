# Product Specification: Arc Keepers

## 1. Project Overview

**Arc Keepers** is a Progressive Web App (PWA) companion for the game _ARC Raiders_. It helps players track "Loot Items" needed for various game goals (crafting, quests, upgrades).

- **Goal:** A "to-do list" for loot. Users see what they need, track what they have picked up, and hide items once requirements are met.
- **Platform:** Web / PWA (GitHub Pages).
- **Privacy:** No backend. All data persists in browser `localStorage`.
- **UX Priority:** Fast keyboard navigation, dark mode, high-density information.

## 2. Technical Stack

- **Framework:** React (Vite) + TypeScript.
- **Styling:** Tailwind CSS.
- _Theme:_ Dark, slate/zinc palette, high contrast text.

- **State Management:** **Zustand**.
- Middleware: `persist` (for LocalStorage).

- **Data Parsing:** `papaparse` (for CSV ingestion).
- **Icons:** `lucide-react`.

## 3. Data Architecture

### 3.1. Concepts

1. **Required Items:** A read-only reference list of all items in the game.
2. **Keeplists:** "Buckets" of requirements.

- _Inventory Logic:_ Inventory is **Allocated**, not Global. If "Workbenches" needs 5 Resin and "Quests" needs 5 Resin, they are tracked separately. Adding to one does not affect the other.

### 3.2. Data Models (TypeScript)

```typescript
// Read-only reference from CSV
interface RequiredItem {
  id: string; // e.g., "rusted-gear"
  name: string; // e.g. "Rusted Gear"
  rarity: "Common" | "Uncommon" | "Rare" | "Epic";
}

// User State (Persisted)
interface AppState {
  keeplists: Keeplist[];
  settings: {
    showCompleted: boolean;
  };
}

interface Keeplist {
  id: string; // Autogenerated slug from the name
  name: string; // e.g., "Workbenches", "Expedition 2"
  isSystem: boolean; // true = provided by app, false = user made
  items: KeeplistItem[];
}

interface KeeplistItem {
  itemId: string; // Relates to RequiredItem.id
  qtyOwned: number; // User input
  qtyRequired: number; // Target (from system or user).
  // NOTE: If 0/null, implies "infinite demand"
  isCompleted: boolean; // Derived state (owned >= required)
}
```

### 3.3. Data Sources

**Item Data:** Fetched from the MetaForge API using the Item Crawler dev tool (`npm run fetch-items`). Stored in `src/data/allItems.ts`.

**System Keeplists:** Maintained using the Keeplist Builder dev tool and stored in `src/data/systemKeeplists.ts`. The app ships with predefined keeplists (e.g., "Workbenches", "Expedition 2", "Flickering Flames").

## 4. Core Logic

### 4.1. System Data Merging (Versioning)

When the app loads, it checks against a "System Data" file.

- **Scenario:** The app maintainer updates the required count for an item in a System Keeplist.
- **Logic:**

1. If the user's local item was **Incomplete**: Update `qtyRequired` to the new value. Preserve user's `qtyOwned`.
2. If the user's local item was **Complete** (`qtyOwned` >= old `qtyRequired`): Update `qtyRequired` AND set `qtyOwned` to the new `qtyRequired`.

- _Reasoning:_ Assume the user already turned in the quest/item, so they don't need to hunt for the difference.

### 4.2. Visual Feedback & Completion

- **Progress:** Visual bar indicating `qtyOwned / qtyRequired`.
- **Quick Tick:** A "Check" button on every row that instantly sets `qtyOwned` to `qtyRequired`.
- **Dimming:** When a specific row (Item X in List Y) is complete, that row dims.
- **Fading:** If **ALL** active rows for a Required Item are complete, the entire Required Item card fades out after **5 seconds** (CSS transition) and is removed from the view (unless "Show Completed" is enabled).

### 4.3. Data Migration

- **Export:** Button to download current state (`localStorage` dump) as JSON.
- **Import:** Button to upload JSON and overwrite `localStorage`.

## 5. User Interface (UI)

### 5.1. Layout

- **Header:** Logo, "Show Completed" toggle, Settings (Import/Export).
- **Intro:** A small, collapsible section explaining how the app works (Keeplists, Allocations).
- **Search Bar:** Sticky top. Performs "Subtext Matching" (fuzzy search).
- **Main View:** Vertical list of **Required Item Cards**.

### 5.2. Item Card Design

The list is organized by **Item**, not by List. Sorted alphabetically by name.

- **Card Header:** [Icon] **Item Name** [Rarity Badge]
- **Card Body:** A list of "Demand Rows" (one row per Keeplist requiring this item).
- _Row:_ `[Keeplist Name] ....... [Owned] / [Required]  [-] [+] [Tick]`

- **Behavior:** Only show Item Cards that have at least one active (incomplete) requirement, unless "Show Completed" is on.

### 5.3. Keyboard Navigation (Critical)

- **Alpha-Hijack:**
- If the user types `a-z`, even if the focus is an input field:

1. Focus the Search Bar.
2. Input the pressed key (append to existing text).

Note: This does not apply to `0-9` or any other characters.

- **Tab Traversal:**
- `TAB` moves focus through interactive elements (`+`, `-`, `Tick`).
- Flow: After the last control of Item A, focus moves to the first control of Item B.
- Search Interaction: As the search filters the list, the Tab order updates immediately to reflect the visible items.

### 5.4. Image Handling

- **Placeholder Logic:**

```javascript
// Use this strictly for now
const getItemImage = (slug: string) =>
  `https://placehold.co/64x64/333/FFF?text=${slug
    .substring(0, 2)
    .toUpperCase()}`;
```

## 6. Developer Tools (Internal)

_These tools should be accessible via a hidden route (e.g., `/dev`) to allow maintainers to generate the CSV files and test assets._

### 6.1. Item Crawler (API to CSV)

A tool to fetch Required Item data.

- **Source:** `https://metaforge.app/arc-raiders/api`
- **Task:** The AI must read the API documentation/response structure from this URL.
- **Output:** A button that fetches the data and converts it into a CSV format matching the `RequiredItem` interface (Id, Name, Category, Rarity, ImageSlug).

### 6.2. Keeplist Builder

A UI tool to create the "System Keeplists".

- **Function:** Allow the developer to select items from the Master List, set `qtyRequired`, and assign them to a list name (e.g., "Workbenches").
- **Output:** Export the result as a CSV file (`system_keeplists.csv`).

### 6.3. Image Integrity Tester

A tool to ensure image URLs are valid.

- **Function:** Iterate through the entire `RequiredItem` list.
- **Logic:** Run the `getItemImage(slug)` function for every item and attempt to fetch the image.
- **Report:** Display a list of any items that return a 404 or error, ensuring the production app doesn't have broken images.
